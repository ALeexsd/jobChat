# üß™ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é WebSocket

## –ü—Ä–æ–±–ª–µ–º–∞
WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –æ—à–∏–±–∫—É 1006.

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –í–∞—Ä–∏–∞–Ω—Ç 1: –¢–µ—Å—Ç —á–µ—Ä–µ–∑ HTML —Å—Ç—Ä–∞–Ω–∏—Ü—É (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `test_websocket.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000 –≤ –¥—Ä—É–≥–æ–π –≤–∫–ª–∞–¥–∫–µ
3. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ admin / admin123
4. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12) –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:
   ```javascript
   localStorage.getItem('access_token')
   ```
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω
6. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ –≤–∫–ª–∞–¥–∫—É —Å `test_websocket.html`
7. –í—Å—Ç–∞–≤—å—Ç–µ —Ç–æ–∫–µ–Ω –≤ –ø–æ–ª–µ
8. –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket"

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω!
üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: {"type":"connected",...}
```

**–ï—Å–ª–∏ –æ—à–∏–±–∫–∞:**
- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏ –∏–∑ —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ: `docker logs chat_backend --tail 100`
- –û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ –æ–±–∞ –ª–æ–≥–∞

### –í–∞—Ä–∏–∞–Ω—Ç 2: –¢–µ—Å—Ç —á–µ—Ä–µ–∑ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:3000
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ admin / admin123
3. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
4. –í—ã–ø–æ–ª–Ω–∏—Ç–µ:

```javascript
// –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω
const token = localStorage.getItem('access_token')
console.log('Token:', token)

// –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket
const ws = new WebSocket(`ws://localhost:8000/ws?token=${token}`)

ws.onopen = () => {
    console.log('‚úÖ WebSocket OPENED!')
    console.log('ReadyState:', ws.readyState)
}

ws.onmessage = (e) => {
    console.log('üì® Message:', e.data)
}

ws.onerror = (e) => {
    console.error('‚ùå Error:', e)
}

ws.onclose = (e) => {
    console.log('üîå Closed:', e.code, e.reason)
}
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ WebSocket OPENED!
ReadyState: 1
üì® Message: {"type":"connected",...}
```

## üêõ –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–¥ 1006 (Abnormal Closure)

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
docker logs chat_backend -f
```

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
```
INFO: WebSocket connection attempt with token: eyJhbGciOiJIUzI1NiIs...
```

**–ï—Å–ª–∏ –ª–æ–≥–æ–≤ –Ω–µ—Ç:**
- Backend –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend –∑–∞–ø—É—â–µ–Ω: `docker ps | grep chat_backend`
- –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ: `docker restart chat_backend`

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ö–æ–¥ 1008 (Policy Violation)

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –í—ã–π–¥–∏—Ç–µ –∏–∑ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
2. –í–æ–π–¥–∏—Ç–µ —Å–Ω–æ–≤–∞
3. –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω
4. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ—Ç –ª–æ–≥–æ–≤ –≤ backend

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞–ø—Ä–æ—Å –Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ backend

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend —Å–ª—É—à–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 8000
curl http://localhost:8000/
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"message":"Corporate Messenger API","version":"1.0.0"}
```

**–ï—Å–ª–∏ –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç:**
```bash
docker restart chat_backend
```

## üìä Backend –ª–æ–≥–∏

–ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
```
INFO: WebSocket connection attempt with token: eyJhbGciOiJIUzI1NiIs...
INFO: User 1 connected. Total connections: 1
INFO: Added user 1 to chat 9
INFO: Added user 1 to chat 10
INFO: Added user 1 to chat 19
```

## üîß –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ–≥–æ
```bash
docker-compose restart
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ backend –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
```bash
docker logs chat_backend -f
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
```bash
docker-compose ps
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API
```bash
curl http://localhost:8000/
```

## ‚úÖ –ï—Å–ª–∏ WebSocket –ø–æ–¥–∫–ª—é—á–∏–ª—Å—è

–û—Ç–ª–∏—á–Ω–æ! –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –æ—Ç–ø—Ä–∞–≤–∫—É —Å–æ–æ–±—â–µ–Ω–∏–π:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–≤–∞ –æ–∫–Ω–∞ –±—Ä–∞—É–∑–µ—Ä–∞
2. –í–æ–π–¥–∏—Ç–µ –∫–∞–∫ user1 –≤ –ø–µ—Ä–≤–æ–º, user2 –≤–æ –≤—Ç–æ—Ä–æ–º
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–∑ –ø–µ—Ä–≤–æ–≥–æ –æ–∫–Ω–∞
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–æ –≤—Ç–æ—Ä–æ–º –æ–∫–Ω–µ:
   - –ü–æ—è–≤–∏–ª–æ—Å—å —Å–æ–æ–±—â–µ–Ω–∏–µ
   - –ß–∞—Ç –ø–µ—Ä–µ–º–µ—Å—Ç–∏–ª—Å—è –Ω–∞–≤–µ—Ä—Ö
   - –ü–æ—è–≤–∏–ª—Å—è —Å—á–µ—Ç—á–∏–∫

## ‚ùå –ï—Å–ª–∏ WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

–í—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—É—é –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend:**
   ```bash
   docker logs chat_backend --tail 100 > backend_logs.txt
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ frontend:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å (F12)
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤—Å–µ –ª–æ–≥–∏

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤—Ä—É—á–Ω—É—é:**
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `test_websocket.html`
   - –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ª–æ–≥–∏

4. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ –º–Ω–µ:**
   - backend_logs.txt
   - –õ–æ–≥–∏ –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞
   - –õ–æ–≥–∏ –∏–∑ test_websocket.html

---

## üéØ –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**–û—Ç–∫—Ä–æ–π—Ç–µ `test_websocket.html` –≤ –±—Ä–∞—É–∑–µ—Ä–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç!**

–§–∞–π–ª –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞: `E:\ch2\test_websocket.html`

–ü—Ä–æ—Å—Ç–æ –æ—Ç–∫—Ä–æ–π—Ç–µ –µ–≥–æ –¥–≤–æ–π–Ω—ã–º –∫–ª–∏–∫–æ–º –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä.

---

**–î–∞—Ç–∞:** 23.11.2025 12:35
