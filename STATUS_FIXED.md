# ✅ Статус онлайн/офлайн исправлен

## Проблема
Статусы показывались наоборот - онлайн пользователи показывались как офлайн и наоборот.

## Причина
Backend использовал неправильные значения enum:
- Было: `UserStatus.online` и `UserStatus.offline` (строчными)
- Правильно: `UserStatus.ONLINE` и `UserStatus.OFFLINE` (заглавными)

## Решение
Исправлены все места в `backend/app/websocket/manager.py`:

```python
# При подключении
user.status = UserStatus.ONLINE  # было: UserStatus.online

# При отключении
user.status = UserStatus.OFFLINE  # было: UserStatus.offline
```

## Как работает сейчас

### При подключении WebSocket:
1. Пользователь открывает приложение
2. WebSocket подключается
3. Backend устанавливает `status = 'ONLINE'` в БД
4. Другие пользователи получают уведомление

### При отключении:
1. Пользователь закрывает вкладку/браузер
2. WebSocket отключается
3. Backend устанавливает `status = 'OFFLINE'` в БД
4. Другие пользователи получают уведомление

## Проверка в логах

Backend теперь пишет в логи:
```
INFO: User 4 status set to online
UPDATE users SET status='ONLINE', last_seen=...
```

## Тестирование

### Тест 1: Проверка статуса при входе
1. Откройте два окна браузера
2. В первом окне войдите как user1
3. Во втором окне войдите как user2
4. В окне user1 откройте профиль user2
5. ✅ Должен показывать "онлайн" (зеленый)

### Тест 2: Проверка статуса при выходе
1. Закройте окно user2
2. Подождите 2-3 секунды
3. В окне user1 обновите страницу
4. Откройте профиль user2
5. ✅ Должен показывать "офлайн" (серый)

### Тест 3: Проверка в списке сотрудников
1. Откройте страницу "Сотрудники"
2. Пользователи с зеленым индикатором - онлайн
3. Пользователи с серым индикатором - офлайн

## Где отображается статус

1. **Профиль пользователя** - индикатор рядом с аватаром
2. **Список сотрудников** - индикатор рядом с каждым сотрудником
3. **Заголовок чата** - "онлайн" или "офлайн" под именем

## Проверка в базе данных

Можно проверить статусы напрямую в БД:
```bash
docker exec -it chat_postgres psql -U chatuser -d chatdb -c "SELECT id, username, status, last_seen FROM users;"
```

Должно показать:
```
 id | username | status  | last_seen
----+----------+---------+------------------------
  1 | admin    | ONLINE  | 2025-11-23 11:00:56...
  2 | user1    | OFFLINE | 2025-11-23 10:55:00...
  3 | user2    | ONLINE  | 2025-11-23 11:01:00...
```

## Готово!

Статусы теперь работают правильно:
- ✅ Онлайн пользователи показываются как онлайн
- ✅ Офлайн пользователи показываются как офлайн
- ✅ Статус обновляется автоматически
- ✅ Другие пользователи видят изменения

Обновите страницу (Ctrl+R) и проверьте статусы!

---

**Дата:** 23.11.2025 14:05
**Статус:** ✅ Исправлено
