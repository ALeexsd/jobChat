# Расширенный функционал групповых чатов

## Новые возможности

### 1. Модальное окно настроек группы (GroupSettingsModal.vue)

Полнофункциональное управление групповым чатом:

#### Информация о группе
- ✅ Редактирование названия группы
- ✅ Добавление/редактирование описания группы
- ✅ Автосохранение изменений

#### Управление участниками
- ✅ Просмотр всех участников группы
- ✅ Добавление новых участников через поиск
- ✅ Удаление участников из группы
- ✅ Изменение ролей участников (Участник/Администратор)
- ✅ Защита от удаления последнего администратора
- ✅ Счетчик участников

#### Поиск пользователей
- ✅ Поиск по имени, фамилии и username
- ✅ Фильтрация уже добавленных участников
- ✅ Отображение аватаров пользователей

#### Опасная зона
- ✅ Кнопка "Покинуть группу"
- ✅ Подтверждение действия

### 2. Интеграция с ChatDetailView

#### Новая кнопка в меню
- ✅ Кнопка "Настройки группы" (только для групповых чатов)
- ✅ Иконка шестеренки (Cog6ToothIcon)
- ✅ Условное отображение (только для chat_type === 'group')

#### Обработчики событий
- ✅ `@updated` - обновление данных чата после изменений
- ✅ `@left` - обработка выхода из группы
- ✅ Автоматическое перенаправление на список чатов

## Структура компонента GroupSettingsModal

```vue
<GroupSettingsModal
  :show="showGroupSettings"
  :chat-id="chatId"
  @close="showGroupSettings = false"
  @updated="loadChat"
  @left="handleLeftGroup"
/>
```

### Props
- `show` (Boolean) - показать/скрыть модальное окно
- `chatId` (Number, required) - ID группового чата

### Events
- `close` - закрытие модального окна
- `updated` - успешное обновление настроек
- `left` - пользователь покинул группу

## API Endpoints (требуются на бэкенде)

### Участники группы
```
GET    /api/chats/{chat_id}/members/     - Список участников
POST   /api/chats/{chat_id}/members/     - Добавить участника
DELETE /api/chats/{chat_id}/members/{user_id}/ - Удалить участника
PATCH  /api/chats/{chat_id}/members/{user_id}/ - Изменить роль
```

### Настройки группы
```
PATCH  /api/chats/{chat_id}/            - Обновить название/описание
POST   /api/chats/{chat_id}/leave/      - Покинуть группу
```

## Дизайн

### Светлая тема
- Белый фон модального окна
- Серые границы разделов
- Синие акценты для кнопок

### Темная тема
- Темно-серый фон (dark:bg-gray-800)
- Темные границы (dark:border-gray-700)
- Адаптированные цвета текста и элементов

## Функции безопасности

1. **Защита администраторов**
   - Нельзя удалить последнего администратора
   - Кнопка удаления скрыта для последнего админа

2. **Подтверждения действий**
   - Подтверждение при удалении участника
   - Подтверждение при выходе из группы

3. **Валидация**
   - Проверка прав доступа на бэкенде
   - Обработка ошибок с понятными сообщениями

## Использование

### Открыть настройки группы
1. Откройте групповой чат
2. Нажмите на меню (три точки) в правом верхнем углу
3. Выберите "Настройки группы"

### Добавить участника
1. В настройках группы нажмите "+ Добавить участника"
2. Введите имя, фамилию или username в поиск
3. Нажмите на пользователя из списка

### Изменить роль участника
1. В списке участников выберите роль из выпадающего списка
2. Изменения сохраняются автоматически

### Удалить участника
1. Нажмите на иконку X рядом с участником
2. Подтвердите действие

### Покинуть группу
1. Прокрутите вниз до "Опасной зоны"
2. Нажмите "Покинуть группу"
3. Подтвердите действие

## Проверьте

1. ✅ Создайте групповой чат
2. ✅ Откройте настройки группы
3. ✅ Измените название и описание
4. ✅ Добавьте участников
5. ✅ Измените роли участников
6. ✅ Удалите участника
7. ✅ Проверьте работу в темной теме

Frontend перезапущен с новым функционалом.
