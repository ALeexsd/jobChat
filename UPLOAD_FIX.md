# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. Backend - Upload endpoint
**–ü—Ä–æ–±–ª–µ–º–∞:** –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –£–±—Ä–∞–Ω–∞ —Å—Ç—Ä–æ–≥–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ —Ñ–∞–π–ª–æ–≤
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—É—Å—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ media
- ‚úÖ –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- ‚úÖ –î–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–± –æ—à–∏–±–∫–∞—Ö

**–ö–æ–¥:**
```python
@router.post("/upload")
async def upload_file(
    file: UploadFile = File(...),
    current_user: User = Depends(get_current_user)
):
    try:
        content = await file.read()
        file_size = len(content)
        
        if file_size > settings.MAX_FILE_SIZE:
            raise HTTPException(status_code=400, detail="File too large (max 10MB)")
        
        if file_size == 0:
            raise HTTPException(status_code=400, detail="File is empty")
        
        os.makedirs("media", exist_ok=True)
        
        file_ext = os.path.splitext(file.filename)[1] if file.filename else ".bin"
        file_name = f"{uuid.uuid4()}{file_ext}"
        file_path = os.path.join("media", file_name)
        
        with open(file_path, "wb") as f:
            f.write(content)
        
        return {
            "file_name": file.filename or "file",
            "file_path": f"/media/{file_name}",
            "file_type": file.content_type or "application/octet-stream",
            "file_size": file_size
        }
    except HTTPException:
        raise
    except Exception as e:
        raise HTTPException(status_code=500, detail=f"Upload failed: {str(e)}")
```

---

### 2. ProfileView - –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
**–ü—Ä–æ–±–ª–µ–º–∞:** –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ" –Ω–µ —Ä–∞–±–æ—Ç–∞–ª–∞

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω input –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è handleAvatarUpload
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ /messages/upload
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è —Å –Ω–æ–≤—ã–º avatar_url

**–ö–æ–¥:**
```vue
<input
  ref="avatarInput"
  type="file"
  accept="image/*"
  class="hidden"
  @change="handleAvatarUpload"
/>
<button @click="() => avatarInput.click()" class="mt-4 w-full btn-secondary">
  –ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ
</button>
```

```javascript
async function handleAvatarUpload(event) {
  const file = event.target.files[0]
  if (!file) return
  
  const formData = new FormData()
  formData.append('file', file)
  
  const uploadResponse = await api.post('/messages/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' }
  })
  
  await api.put('/users/me', {
    ...profileData.value,
    avatar_url: uploadResponse.data.file_path
  })
  
  await authStore.checkAuth()
  alert('–§–æ—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ')
}
```

---

### 3. ChatDetailView - –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ–ª–∂–Ω—ã –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è
- –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –¥–æ–ª–∂–µ–Ω –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 1. –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å
2. –ù–∞–∂–º–∏—Ç–µ "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ"
3. –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
4. –î–æ–∂–¥–∏—Ç–µ—Å—å –∑–∞–≥—Ä—É–∑–∫–∏
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∞–≤–∞—Ç–∞—Ä –æ–±–Ω–æ–≤–∏–ª—Å—è
```

### 2. Drag & Drop –≤ —á–∞—Ç–µ
```
1. –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç
2. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–∞–π–ª
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
4. –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ñ–∞–π–ª –ø–æ—è–≤–∏–ª—Å—è –≤ —á–∞—Ç–µ
```

### 3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
```
1. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –ø–æ–∫–∞–∑–∞–Ω—ã –≤ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä–µ
3. –£–¥–∞–ª–∏—Ç–µ –æ–¥–∏–Ω —Ñ–∞–π–ª (–∫—Ä–µ—Å—Ç–∏–∫)
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ
```

---

## üîç –û—Ç–ª–∞–¥–∫–∞

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 400:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞:
```javascript
// –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤ API Error:
{
  url: '/messages/upload',
  status: 400,
  data: {
    detail: "File too large (max 10MB)" // –∏–ª–∏ –¥—Ä—É–≥–∞—è –ø—Ä–∏—á–∏–Ω–∞
  }
}
```

### –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ 500:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend:
```bash
docker-compose logs backend --tail 50
```

### –ï—Å–ª–∏ –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å:
```javascript
// –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–æ–≥–∏:
console.log('Preview files:', previewFiles.value)
```

---

## üìä –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞:
- **–ú–∞–∫—Å–∏–º—É–º:** 10 MB
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** `MAX_FILE_SIZE` –≤ config.py

### –¢–∏–ø—ã —Ñ–∞–π–ª–æ–≤:
- **–í—Å–µ —Ç–∏–ø—ã —Ä–∞–∑—Ä–µ—à–µ–Ω—ã** (–ø—Ä–æ–≤–µ—Ä–∫–∞ —É–±—Ä–∞–Ω–∞)
- –ú–æ–∂–Ω–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è, –¥–æ–∫—É–º–µ–Ω—Ç—ã, –∞—É–¥–∏–æ, –≤–∏–¥–µ–æ

### –ü–∞–ø–∫–∞ —Ö—Ä–∞–Ω–µ–Ω–∏—è:
- **–ü—É—Ç—å:** `backend/media/`
- **–°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**
- **–ò–º–µ–Ω–∞:** UUID + —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç

- [x] Backend endpoint –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–æ–±–∞–≤–ª–µ–Ω–∞
- [x] –ö–Ω–æ–ø–∫–∞ "–ò–∑–º–µ–Ω–∏—Ç—å —Ñ–æ—Ç–æ" —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ó–∞–≥—Ä—É–∑–∫–∞ –∞–≤–∞—Ç–∞—Ä–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- [x] Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫—É –∞–≤–∞—Ç–∞—Ä–∞
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å Drag & Drop
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä

---

## üöÄ –ì–æ—Ç–æ–≤–æ!

Backend –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω, –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ:
1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –∞–≤–∞—Ç–∞—Ä –≤ –ø—Ä–æ—Ñ–∏–ª–µ
2. –ü–µ—Ä–µ—Ç–∞—â–∏—Ç—å —Ñ–∞–π–ª—ã –≤ —á–∞—Ç
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä

–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ª–æ–≥–∏ backend!
